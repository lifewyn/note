---
time: 2025-03-26
tags:
  - scom
---
### 在新平台上对射线机需要2个串口控制，可以采用两种方案：  
（1）通过一个串口挂载2个串口设备；  
（2）分别通过两个独立串口接口控制。

### 一、**方案 1：在一个 485 接口上连接两个设备**
#### **软件特点**
1. **时序控制复杂**
   - 需要严格控制命令发送的时序。
   - 需要在发送命令后等待足够的时间，确保设备响应完成后再发送下一个命令。
   - 需要考虑设备响应时间的差异，动态调整等待时间。
2. **冲突检测与处理**
   - 需要实现冲突检测机制，例如通过检测总线上的信号来判断是否发生冲突。
   - 如果发生冲突，需要重新发送命令或采取其他措施。
3. **设备地址管理**
   - 需要为每个设备分配唯一的地址，并在发送命令时正确设置目标设备的地址。
   - 需要确保设备地址不冲突，并且能够正确识别每个设备的响应。
4. **调试难度大**
   - 在共享总线上调试时，容易受到其他设备的干扰，导致调试复杂。
   - 需要同时监控多个设备的通信状态，增加了调试的难度。

###  二、**方案 2：使用两个独立的 485 接口分别连接两个设备**
#### **软件特点**
1. **时序控制简单**
   - 每个接口只连接一个设备，因此不需要考虑设备之间的冲突。
   - 可以独立控制每个接口的通信时序，无需担心设备响应时间的差异。
   - 可以同时对两个设备进行操作，而不会相互干扰。
2. **无需冲突检测**
   - 由于每个接口只连接一个设备，不存在冲突的可能性，因此无需实现冲突检测机制。
   - 简化了通信逻辑，减少了出错的可能性。
3. **设备管理简单**
   - 每个设备通过独立的接口连接，无需管理设备地址。
   - 可以直接通过接口区分设备，简化了设备识别和管理的逻辑。
4. **调试方便**
   - 每个接口的通信独立，调试时可以单独关注一个接口的通信状态。
   - 减少了调试的复杂性，提高了开发效率。
5. **并行处理能力**
   - 可以同时对两个设备进行操作，例如在一个线程中处理一个设备的通信，而在另一个线程中处理另一个设备的通信。
   - 提高了系统的响应速度和效率。
6. **硬件要求增加**
   - 需要两个独立的 485 接口，增加了硬件成本。
   - 需要更多的串口资源，可能需要额外的硬件支持（如多串口卡）。

### 三、**软件设计对比**
| **特性**   | **方案 1（单接口多设备）** | **方案 2（多接口单设备）**   |
| -------- | ---------------- | ------------------ |
| **时序控制** | 复杂，需要严格控制时序，避免冲突 | 简单，每个接口独立控制，无需担心冲突 |
| **冲突检测** | 需要实现冲突检测机制       | 无需冲突检测机制           |
| **调试难度** | 调试复杂，容易受到其他设备干扰  | 调试简单，每个接口独立调试      |
| **硬件要求** | 单个 485 接口，硬件成本低  | 需要两个 485 接口，硬件成本高  |

### 四、**软件测试结果**
#### 1.测试两个串口订阅同一主题接收时间戳测试：
![[Pasted image 20250327142343.png]]
#### 2.测试除第一个条件上，添加另一个定时发布订阅的led处理，测试串口接收时间戳测试：
![[Pasted image 20250327142529.png]]
#### 3.测试除第一二条件上，添加多个订阅者订阅串口相同的测试主题，测试串口接收时间戳测试
![[Pasted image 20250327142428.png]]
#### 总结：
统计的三种工况，两者的时间戳不超过15ms

### 五、**总结**
如果选择使用两个独立的 485 接口分别连接两个设备，软件设计会更加简单和直观：
- **时序控制**更加简单，无需考虑设备之间的冲突。
- **调试**更加方便，可以独立监控每个接口的通信状态。
- **并行处理能力**更强，可以同时对两个设备进行操作。
- **设备管理**更加简单，无需管理设备地址。
