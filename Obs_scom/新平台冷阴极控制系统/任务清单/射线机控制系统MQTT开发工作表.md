
## 1. 基础设施开发

| 编号  | 任务名称            | 功能描述                   | 技术要点                                              | 输入/输出                         | 测试要点                                    | 完成状态 |
| --- | --------------- | ---------------------- | ------------------------------------------------- | ----------------------------- | --------------------------------------- | ---- |
| 1.1 | MQTT Broker安装配置 | 安装和配置Mosquitto MQTT服务器 | 1. 安装Mosquitto<br>2. 配置服务器参数<br>3. 设置安全认证         | 输入: 配置参数<br>输出: 运行中的MQTT服务器   | 1. 服务器启动测试<br>2. 连接测试<br>3. 安全认证测试      | <br> |
| 1.2 | MQTT客户端基础库开发    | 开发MQTT客户端基础功能库         | 1. 使用Eclipse Paho C库<br>2. 封装连接管理<br>3. 封装发布/订阅功能 | 输入: MQTT服务器地址<br>输出: MQTT客户端库 | 1. 连接测试<br>2. 发布/订阅测试<br>3. 断线重连测试      |      |
| 1.3 | JSON解析库集成       | 集成JSON解析库用于消息序列化/反序列化  | 1. 使用cJSON库<br>2. 封装JSON解析函数<br>3. 实现消息格式转换       | 输入: JSON字符串<br>输出: 结构化数据      | 1. JSON解析测试<br>2. JSON生成测试<br>3. 错误处理测试 |      |
| 1.4 | 日志系统开发          | 开发系统日志记录功能             | 1. 实现多级日志<br>2. 支持文件和控制台输出<br>3. 支持日志轮转           | 输入: 日志消息<br>输出: 格式化日志         | 1. 日志级别测试<br>2. 日志输出测试<br>3. 日志轮转测试     |      |
| 1.5 | 错误处理机制开发        | 开发统一的错误处理机制            | 1. 定义错误码<br>2. 实现错误处理函数<br>3. 支持错误传播              | 输入: 错误码<br>输出: 错误处理结果         | 1. 错误码测试<br>2. 错误处理测试<br>3. 错误恢复测试      |      |

## 2. 核心模块开发

| 编号   | 任务名称              | 功能描述                   | 技术要点                                                                               | 输入/输出                        | 测试要点                                 | 完成状态 |
| ---- | ----------------- | ---------------------- | ---------------------------------------------------------------------------------- | ---------------------------- | ------------------------------------ | ---- |
| 2.1  | X射线控制模块(xray485)  | 通过MQTT实现与X射线管的Modbus通信 | 1. 订阅`xray/modbus/command`<br>2. 发布`xray/modbus/response`<br>3. 实现Modbus RTU协议     | 输入: Modbus命令<br>输出: Modbus响应 | 1. 命令执行测试<br>2. 响应正确性测试<br>3. 异常处理测试 |      |
| 2.2  | 网络通信模块(ETH-man)   | 实现TCP到MQTT的桥接          | 1. 监听TCP连接<br>2. 转发TCP消息到MQTT<br>3. 转发MQTT响应到TCP                                   | 输入: TCP消息<br>输出: MQTT消息      | 1. 连接测试<br>2. 消息转发测试<br>3. 断线重连测试    |      |
| 2.3  | 串口通信模块(Uart-man)  | 实现串口到MQTT的桥接           | 1. 监听串口数据<br>2. 转发串口消息到MQTT<br>3. 转发MQTT响应到串口                                      | 输入: 串口数据<br>输出: MQTT消息       | 1. 串口通信测试<br>2. 消息转发测试<br>3. 错误处理测试  |      |
| 2.4  | 配置管理模块(cfg)       | 处理射线机参数配置              | 1. 订阅`xray/control/cfg`<br>2. 发布`xray/control/cfg/response`<br>3. 发布Modbus命令       | 输入: 配置参数<br>输出: 配置结果         | 1. 参数验证测试<br>2. 配置执行测试<br>3. 错误处理测试  |      |
| 2.5  | 参数查询模块(fetch)     | 查询射线机当前参数              | 1. 订阅`xray/control/query`<br>2. 发布`xray/control/query/response`<br>3. 查询Modbus参数   | 输入: 查询请求<br>输出: 参数数据         | 1. 查询执行测试<br>2. 数据正确性测试<br>3. 错误处理测试 |      |
| 2.6  | 曝光控制模块(explosive) | 控制射线机曝光                | 1. 订阅`xray/control/opt`<br>2. 发布`xray/control/opt/response`<br>3. 发布Modbus命令       | 输入: 曝光命令<br>输出: 曝光结果         | 1. 曝光执行测试<br>2. 曝光状态测试<br>3. 安全检查测试  |      |
| 2.7  | 延迟曝光模块(delay_cmd) | 实现延迟曝光功能               | 1. 订阅`xray/control/delay`<br>2. 发布`xray/control/delay/response`<br>3. 倒计时管理        | 输入: 延迟参数<br>输出: 延迟状态         | 1. 倒计时测试<br>2. 延迟曝光测试<br>3. 中断处理测试   |      |
| 2.8  | 紧急停止模块(stop_cmd)  | 实现紧急停止功能               | 1. 订阅`xray/control/emg_stop`<br>2. 发布`xray/control/emg_stop/response`<br>3. 发布停止命令 | 输入: 停止命令<br>输出: 停止结果         | 1. 停止执行测试<br>2. 状态更新测试<br>3. 恢复测试    |      |
| 2.9  | 系统版本模块            | 提供系统版本信息               | 1. 订阅`xray/control/version`<br>2. 发布`xray/control/version/response`                | 输入: 版本查询<br>输出: 版本信息         | 1. 版本查询测试<br>2. 响应格式测试               |      |
| 2.10 | 系统时间模块            | 更新系统时间                 | 1. 订阅`xray/control/time`<br>2. 发布`xray/control/time/response`<br>3. 系统时间设置         | 输入: 时间数据<br>输出: 更新结果         | 1. 时间设置测试<br>2. 格式验证测试<br>3. 错误处理测试  |      |

## 3. 外设模块开发

| 编号  | 任务名称                 | 功能描述      | 技术要点                                                  | 输入/输出                    | 测试要点                                 | 完成状态 |
| --- | -------------------- | --------- | ----------------------------------------------------- | ------------------------ | ------------------------------------ | ---- |
| 3.1 | 液晶显示模块(lcd)          | 显示系统参数和状态 | 1. 订阅LCD相关主题<br>2. 更新显示内容<br>3. 显示格式控制                | 输入: 显示数据<br>输出: LCD显示    | 1. 显示更新测试<br>2. 格式正确性测试<br>3. 刷新率测试  |      |
| 3.2 | LED指示灯模块(led)        | 控制LED指示灯  | 1. 订阅LED相关主题<br>2. 控制LED状态<br>3. 实现闪烁功能               | 输入: LED控制命令<br>输出: LED状态 | 1. 开关测试<br>2. 闪烁测试<br>3. 持续时间测试      |      |
| 3.3 | 蜂鸣器模块(beep)          | 控制蜂鸣器     | 1. 订阅`xray/indicator/beep`<br>2. 控制蜂鸣器状态<br>3. 实现间歇蜂鸣 | 输入: 蜂鸣器控制命令<br>输出: 蜂鸣器状态 | 1. 开关测试<br>2. 间歇蜂鸣测试<br>3. 持续时间测试    |      |
| 3.4 | 电池管理模块(check_power)  | 监测电池状态    | 1. 读取电池电量<br>2. 发布`xray/monitor/battery`<br>3. 低电量检测  | 输入: 电池数据<br>输出: 电量状态     | 1. 电量读取测试<br>2. 低电量报警测试<br>3. 充电状态测试 |      |
| 3.5 | CPU温度检测模块(cpu_tempc) | 监测CPU温度   | 1. 读取CPU温度<br>2. 发布`xray/monitor/cpu_temp`            | 输入: 温度数据<br>输出: 温度状态     | 1. 温度读取测试<br>2. 发布周期测试<br>3. 异常温度测试  |      |
| 3.6 | 选择按键模块(select_key)   | 处理选择按键    | 1. 监测按键状态<br>2. 发布`xray/key/select`                   | 输入: 按键状态<br>输出: 按键事件     | 1. 按键检测测试<br>2. 消抖测试<br>3. 长按测试      |      |
| 3.7 | 延迟按键模块(delay_key)    | 处理延迟按键    | 1. 监测按键状态<br>2. 发布`xray/key/delay`                    | 输入: 按键状态<br>输出: 按键事件     | 1. 按键检测测试<br>2. 消抖测试<br>3. 长按测试      |      |
| 3.8 | 停止按键模块(stop_key)     | 处理停止按键    | 1. 监测按键状态<br>2. 发布`xray/key/stop`                     | 输入: 按键状态<br>输出: 按键事件     | 1. 按键检测测试<br>2. 消抖测试<br>3. 长按测试      |      |

## 4. 数据管理模块开发

| 编号 | 任务名称 | 功能描述 | 技术要点 | 输入/输出 | 测试要点 | 完成状态 |
|-----|--------|---------|---------|----------|---------|---------|
| 4.1 | 历史记录模块(record) | 记录系统历史数据 | 1. 订阅记录相关主题<br>2. 存储历史数据<br>3. 提供查询接口 | 输入: 记录数据<br>输出: 存储结果 | 1. 数据存储测试<br>2. 查询测试<br>3. 存储容量测试 |  |
| 4.2 | 消息持久化模块 | 实现MQTT消息持久化 | 1. 保存关键消息<br>2. 系统重启恢复<br>3. 数据一致性保障 | 输入: MQTT消息<br>输出: 持久化数据 | 1. 持久化测试<br>2. 恢复测试<br>3. 一致性测试 |  |
| 4.3 | 系统状态监控模块(monitor) | 监控系统各进程状态 | 1. 订阅`xray/monitor/process_status`<br>2. 进程健康检查<br>3. 异常处理 | 输入: 进程状态<br>输出: 监控结果 | 1. 状态监控测试<br>2. 异常检测测试<br>3. 恢复测试 |  |

## 5. 系统集成与测试

| 编号  | 任务名称   | 功能描述       | 技术要点                                   | 输入/输出                    | 测试要点                              | 完成状态 |
| --- | ------ | ---------- | -------------------------------------- | ------------------------ | --------------------------------- | ---- |
| 5.1 | 单元测试开发 | 为各模块开发单元测试 | 1. 使用单元测试框架<br>2. 测试各模块功能<br>3. 测试边界条件 | 输入: 测试用例<br>输出: 测试结果     | 1. 功能覆盖率<br>2. 代码覆盖率<br>3. 边界条件测试 |     |
| 5.2 | 模块集成测试 | 测试模块间集成    | 1. 测试模块间通信<br>2. 测试数据流转<br>3. 测试异常处理   | 输入: 集成测试用例<br>输出: 测试结果   | 1. 接口兼容性<br>2. 数据一致性<br>3. 错误传播   |     |
| 5.3 | 系统功能测试 | 测试系统整体功能   | 1. 测试用户场景<br>2. 测试功能流程<br>3. 测试系统响应    | 输入: 功能测试用例<br>输出: 测试结果   | 1. 功能完整性<br>2. 流程正确性<br>3. 响应时间   |     |
| 5.4 | 性能测试   | 测试系统性能     | 1. 测试消息吞吐量<br>2. 测试响应时间<br>3. 测试资源占用   | 输入: 性能测试用例<br>输出: 性能数据   | 1. 吞吐量测试<br>2. 延迟测试<br>3. 资源占用测试  |     |
| 5.5 | 稳定性测试  | 测试系统稳定性    | 1. 长时间运行测试<br>2. 压力测试<br>3. 故障恢复测试     | 输入: 稳定性测试用例<br>输出: 稳定性数据 | 1. 长时间运行<br>2. 高负载测试<br>3. 故障恢复   |     |
| 5.6 | 安全性测试  | 测试系统安全性    | 1. 认证测试<br>2. 授权测试<br>3. 数据安全测试        | 输入: 安全测试用例<br>输出: 安全评估   | 1. 认证机制<br>2. 授权控制<br>3. 数据保护     |     |

## 6. 文档和部署

| 编号  | 任务名称       | 功能描述            | 技术要点                                | 输入/输出                | 测试要点                             | 完成状态 |
| --- | ---------- | --------------- | ----------------------------------- | -------------------- | -------------------------------- | ---- |
| 6.1 | 系统架构文档     | 更新系统架构文档        | 1. 描述系统架构<br>2. 说明模块关系<br>3. 说明通信机制 | 输入: 系统设计<br>输出: 架构文档 | 1. 文档完整性<br>2. 文档准确性<br>3. 文档可读性 |      |
| 6.2 | MQTT主题规范文档 | 编写MQTT主题和消息格式规范 | 1. 描述主题结构<br>2. 说明消息格式<br>3. 提供示例   | 输入: 主题设计<br>输出: 规范文档 | 1. 规范完整性<br>2. 示例正确性<br>3. 文档可读性 |      |
| 6.3 | 模块接口文档     | 编写模块接口文档        | 1. 描述模块功能<br>2. 说明接口参数<br>3. 提供使用示例 | 输入: 模块设计<br>输出: 接口文档 | 1. 接口完整性<br>2. 参数说明<br>3. 示例正确性  |      |
| 6.4 | 部署配置指南     | 编写部署和配置指南       | 1. 说明部署步骤<br>2. 说明配置参数<br>3. 提供故障排除 | 输入: 部署流程<br>输出: 部署指南 | 1. 步骤完整性<br>2. 参数说明<br>3. 故障排除   |      |
| 6.5 | 用户操作手册     | 编写用户操作手册        | 1. 说明操作流程<br>2. 说明界面功能<br>3. 提供常见问题 | 输入: 系统功能<br>输出: 操作手册 | 1. 操作说明<br>2. 界面说明<br>3. 常见问题    |      |
| 6.6 | 系统发布包      | 准备系统发布包         | 1. 编译系统组件<br>2. 打包配置文件<br>3. 准备安装脚本 | 输入: 系统代码<br>输出: 发布包  | 1. 包完整性<br>2. 安装测试<br>3. 版本标识    |      |

## 7. 功能测试用例

| 编号   | 测试用例名称    | 测试目的      | 测试步骤                                  | 预期结果                                        | 完成状态 |
| ---- | --------- | --------- | ------------------------------------- | ------------------------------------------- | ---- |
| 7.1  | 配置射线机参数测试 | 测试参数配置功能  | 1. 发送配置命令<br>2. 检查响应<br>3. 查询参数验证     | 1. 配置成功<br>2. 参数正确设置<br>3. 查询结果一致           |      |
| 7.2  | 立即曝光测试    | 测试立即曝光功能  | 1. 发送曝光命令<br>2. 检查响应<br>3. 验证曝光执行     | 1. 曝光成功启动<br>2. 指示灯正确显示<br>3. 蜂鸣器正确响应       |      |
| 7.3  | 延迟曝光测试    | 测试延迟曝光功能  | 1. 发送延迟曝光命令<br>2. 检查倒计时<br>3. 验证曝光执行  | 1. 倒计时正确显示<br>2. 延迟后曝光启动<br>3. 指示灯和蜂鸣器正确响应  |      |
| 7.4  | 紧急停止测试    | 测试紧急停止功能  | 1. 启动曝光<br>2. 发送紧急停止命令<br>3. 检查系统状态   | 1. 曝光立即停止<br>2. 紧急停止状态正确显示<br>3. 系统安全停机     |      |
| 7.5  | 低电量报警测试   | 测试低电量报警功能 | 1. 模拟低电量状态<br>2. 检查报警指示<br>3. 验证系统响应  | 1. 绿色LED闪烁<br>2. LCD显示低电量<br>3. 系统正确响应低电量状态 |      |
| 7.6  | 选择按键功能测试  | 测试选择按键功能  | 1. 按下选择按键<br>2. 检查参数切换<br>3. 再次按下验证切换 | 1. 参数正确切换<br>2. LCD显示更新<br>3. 配置成功保存        |      |
| 7.7  | 网络通信测试    | 测试网络通信功能  | 1. 通过网络发送命令<br>2. 检查命令执行<br>3. 验证响应接收 | 1. 命令正确转发<br>2. 系统正确执行<br>3. 响应正确返回         |      |
| 7.8  | 串口通信测试    | 测试串口通信功能  | 1. 通过串口发送命令<br>2. 检查命令执行<br>3. 验证响应接收 | 1. 命令正确转发<br>2. 系统正确执行<br>3. 响应正确返回         |      |
| 7.9  | 历史记录测试    | 测试历史记录功能  | 1. 执行多次操作<br>2. 查询历史记录<br>3. 验证记录完整性  | 1. 操作正确记录<br>2. 记录数据完整<br>3. 查询结果正确         |      |
| 7.10 | 系统监控测试    | 测试系统监控功能  | 1. 运行系统一段时间<br>2. 检查监控数据<br>3. 模拟进程异常 | 1. 监控数据正确收集<br>2. 异常正确检测<br>3. 系统正确响应异常     |      |

## 8. 开发进度跟踪

| 阶段 | 计划开始日期 | 计划结束日期 | 实际开始日期 | 实际结束日期 | 完成百分比 | 备注 |
|-----|------------|------------|------------|------------|---------|------|
| 前期准备 | D1 | D1 | | | 0% | |
| 基础设施搭建 | D2 | D4 | | | 0% | |
| 核心模块开发 | D5 | D10 | | | 0% | |
| 外设模块开发 | D11 | D12 | | | 0% | |
| 数据管理模块开发 | D13 | D14 | | | 0% | |
| 系统集成与测试 | D15 | D18 | | | 0% | |
| 文档和部署 | D19 | D20 | | | 0% | |

## 9. 风险管理

| 风险ID | 风险描述 | 可能性 | 影响 | 应对策略 | 责任人 | 状态 |
|--------|---------|-------|------|---------|-------|------|
| R1 | MQTT性能不满足实时要求 | 中 | 高 | 1. 前期进行性能测试<br>2. 优化消息格式和QoS级别<br>3. 必要时实现混合通信机制 | 系统架构师 | 未解决 |
| R2 | 模块改造工作量超出预期 | 高 | 中 | 1. 详细分析现有代码<br>2. 制定合理的改造计划<br>3. 预留缓冲时间 | 项目经理 | 未解决 |
| R3 | 系统稳定性下降 | 中 | 高 | 1. 增加单元测试覆盖率<br>2. 实现健壮的错误处理<br>3. 进行充分的稳定性测试 | 测试工程师 | 未解决 |
| R4 | 团队对MQTT技术不熟悉 | 高 | 中 | 1. 提前进行技术培训<br>2. 引入MQTT专家顾问<br>3. 从简单模块开始改造 | 培训负责人 | 未解决 |
| R5 | 硬件兼容性问题 | 中 | 高 | 1. 提前进行硬件测试<br>2. 准备备用方案<br>3. 与硬件供应商保持沟通 | 硬件工程师 | 未解决 |

## 10. 依赖关系

| 依赖ID | 前置任务 | 后置任务 | 依赖类型 | 备注 |
|--------|---------|---------|---------|------|
| D1 | 1.1 MQTT Broker安装配置 | 1.2 MQTT客户端基础库开发 | 强依赖 | MQTT客户端库需要Broker进行测试 |
| D2 | 1.2 MQTT客户端基础库开发 | 所有使用MQTT的模块 | 强依赖 | 所有模块依赖基础库 |
| D3 | 1.3 JSON解析库集成 | 所有使用JSON的模块 | 强依赖 | 所有模块依赖JSON解析 |
| D4 | 2.1 X射线控制模块 | 2.4 配置管理模块, 2.6 曝光控制模块 | 强依赖 | 这些模块需要与X射线管通信 |
| D5 | 2.7 延迟曝光模块 | 2.6 曝光控制模块 | 弱依赖 | 延迟曝光最终需要触发曝光 |
| D6 | 3.4 电池管理模块 | 3.2 LED指示灯模块 | 弱依赖 | 低电量时需要控制LED |
| D7 | 所有功能模块 | 5.1-5.6 测试任务 | 强依赖 | 测试需要模块实现完成 |
| D8 | 5.1-5.6 测试任务 | 6.1-6.6 文档和部署 | 弱依赖 | 文档需要基于测试验证的系统 |
