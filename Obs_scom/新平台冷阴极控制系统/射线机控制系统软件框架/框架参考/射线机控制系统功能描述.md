---
time: 2025-03-10
tags:
  - C
  - scom
---

## 功能模块概述

| 编号  | 功能模块名称               | 功能描述                                                                                                                                                                                                                                                                                                              | 备注  |
| --- | -------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --- |
| 1   | X射线控制模块 (xray485)    | 1. 通过 Modbus RTU 协议与 X 射线管通信<br>2. 控制 X 射线管的电压、电流和曝光时间<br>3. 支持的最大参数：最大电压 200.0V，最大电流 2000.0mA                                                                                                                                                                                                                    | -   |
| 2   | 液晶模块 (lcd)           | 1. 显示系统参数：<br>    a. 曝光电压<br>    b. 曝光时间<br>    c. 曝光倒计时<br>    d. 曝光紧急停止状态<br>2. 显示系统状态：<br>    a. WiFi 连接状态<br>    b. 网络连接状态<br>    c. 电池电量<br>3. 倒计时功能：<br>    a. 显示曝光倒计时总时间<br>    b. 曝光结束后清零倒计时时间<br>    c. 在延迟曝光过程中，如果接收到曝光停止消息将倒计时时间清零<br>4. 紧急停止显示：<br>    a. 收到曝光紧急停止消息后显示为 “yes”<br>    b. 曝光结束后显示为“no” | -   |
| 3   | 网络通信模块 (sc_eth)      | 1. 实现 TCP 服务器功能<br>2. 接受客户端连接<br>3. 处理网络数据收发                                                                                                                                                                                                                                                                      | -   |
| 4   | 电池管理模块 (check_power) | 1. 实时监测低电量状态<br>    a. 低电量阈值：20%<br>    b. 触发 LED 绿灯闪烁<br>2. 电量变化时将电量百分比发送给 LCD<br>3. 每 4 分钟发给数据库记录一次电池电量                                                                                                                                                                                                         | -   |
| 5   | CPU 温度检测模块           | 1. 每 3 分钟将 CPU 温度发送给数据库                                                                                                                                                                                                                                                                                           | -   |
| 6   | 延迟曝光模块               | 1. 延迟曝光消息处理线程<br>2. 延迟曝光按键处理线程<br>3. 延迟曝光过程中：<br>    a. 发消息给 beep（500ms 蜂鸣一次）<br>    b. lcd（显示曝光倒计时时间）<br>    c. LED 红灯（闪烁）<br>4. 延迟结束：<br>    a. 发送消息给射线管开始曝光<br>    b. 发消息给 beep 蜂鸣 2s<br>    c. 发消息给 lcd（清除曝光倒计时时间）<br>    d. 发消息给红色 LED（亮 2 秒）                                                                | -   |
| 7   | LED 灯模块              | 1. 红灯：<br>    a. 延迟曝光时闪烁<br>    b. 曝光时亮 2 秒<br>2. 绿灯：<br>    a. 电量过低时绿灯亮                                                                                                                                                                                                                                          | -   |
| 8   | 网络串口通信模块 (sc_232)    | 1. 处理串口数据收发                                                                                                                                                                                                                                                                                                       | -   |
| 9   | beep 模块 (sc_beep)    | 1. 延迟曝光过程中 500ms 蜂鸣一次<br>2. 曝光时蜂鸣 2 秒                                                                                                                                                                                                                                                                             | -   |
| 10  | 选择按键模块 (sc_select)   | 1. 按键一次配置电压 200kV、电流 2000mA<br>2. 再按键一次配置电压 100kV、电流 1000mA                                                                                                                                                                                                                                                       | -   |
| 11  | 紧急中断模块 (sc_stop)     | 1. 紧急停止消息处理线程<br>2. 紧急停止按键处理线程<br>3. 紧急停止过程：<br>    a. 中止并重启延迟，beep 和 led<br>    b. 发消息给射线管中止曝光<br>    c. 发消息给 lcd 紧急停止显示为“yes”                                                                                                                                                                                   | -   |
| 12  | 历史记录模块 (sc_record)   | 1. 记录 CPU 的温度数据<br>2. 记录电池电量数据<br>3. 记录配置射线机参数<br>4. 使用 query 获取射线机配置参数<br>5. 记录曝光前后的参数<br>6. 上电恢复射线机配置参数                                                                                                                                                                                                         |     |
| 13  | packman的json数据处理     | 1. 处理 JSON 格式的数据包<br>2. 处理操作命令：<br>    a. cfg--配置射线机参数<br>    b. query--获取射线机参数<br>    c. opt--立即曝光和延迟曝光<br>    d. emg_stop--紧急停止<br>    e. version--查看版本<br>    f. time--更新时间<br>	g. power--查看电池电量                                                                                                               |     |

