---
time: 2025-03-07
tags:
  - scom
---

### 1 ==X射线控制模块 (xray485)==
- 通过 Modbus RTU 协议与 X 射线管通信
- 控制 X 射线管的电压、电流和曝光时间
- 支持的最大参数：
  - 最大电压：200.0V
  - 最大电流：2000.0mA

### 2 ==液晶模块 (lcd)==
#### 2.1 显示内容
- 显示系统参数：电压、曝光时间、倒计时和紧急停止
- 显示系统状态：WiFi 连接状态、网络连接状态、电池电量

#### 2.2 显示内容
- 倒计时：
显示倒计时总时间，结束后清零，接受到停止消息也清零
- 紧急停止：
收到紧急停止消息后，显示为yes，曝光结束后显示no

### 3 ==网络通信模块 (sc_eth)==
- 实现 TCP 服务器功能，接受客户端连接
- 处理网络数据收发

### 4 ==电池管理模块 (check_power)==
#### 4.1 电量常规检测线程
- 实时监测低电量状态，低电量阈值：20%触发LED绿灯闪烁
- 有变化将电量数值发给LCD
- 每4分钟记录一次电池电量

#### 4.2 电量消息处理线程
- 曝光前后检查电池电量
- 反馈packman命令检查电池电量

### 5 ==**CPU温度检测==
- 每3分钟将CPU温度发给历史记录

### 6 ==延迟曝光==
#### 6.1 延迟曝光消息处理线程
- 接受packman发来的消息
- 发消息给beep、led和lcd
- 延迟结束后发消息给beep，射线管和lcd

#### 6.2 延迟曝光按键处理线程
- 发消息给beep、led和lcd
- 延迟结束后发消息给beep，射线管和lcd

### 7 ==LED灯==
#### 7.1 红灯功能
- 延迟曝光时闪烁
- 曝光时亮2秒
#### 7.2 绿灯功能
- 电量过低绿灯亮

### 8 ==网络串口通信模块 (sc_232)==
- 处理串口数据收发

### 9 ==beep模块(sc_beep)==
- 曝光过程中500ms蜂鸣一次
- 曝光时候蜂鸣2s

### 10 ==选择按键(sc_select)==
- 按键一次配置电压200kV 电流2000mA
- 再按键一次配置电压100kV 电流1000mA

### 11 ==紧急中断(sc_stop)==
#### 11.1 紧急停止消息处理线程
- 接受packman发来的紧急停止消息
#### 11.2 紧急停止按键处理线程
- 接受按键发来的紧急停止消息

### 12 ==历史记录(sc_record)==
- cpu的温度数据记录
- check power的数据记录
- 配置射线机参数记录
- 使用query获取射线机配置参数
- 记录曝光前后的参数
- 上电恢复射线机配置参数
